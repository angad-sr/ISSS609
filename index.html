<html>
<head>
    <title>ISSS 609 - Text Analytics and Applications Project - Group 2 </title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="Scripts/d3.min.js"></script>
</head>
<style>
#footer {
   position: fixed;
   left: 0;
   bottom: 0;
   width: 100%;
   background-color: #6c757d;
   color: white;
   text-align: center;
   height:50px;
   font-size:18px;
}
.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  text-align: center;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
<body>
<!-- Common header section-->
<div style="background-color:#6c757d;text-align:center;vertical-align:center;padding:3px;color:White;">   
    <span style="text-align:center;"><h2>Welcome to the SG News Portal!</h2></span>
</div>


<!--Body Section-->
<div class="mainbody_content" style="padding-top:10px;">
<div class="dropdown" style="margin-left:5%;padding-top:10px;">
    <div>
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" style="background-color:#6c757d;border-color:#6c757d;">
            <span style="padding-right:5px;">Existing or New User?</span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><a onclick="DisplayUserSelection('existing')">Existing User</a></li>
          <li><a onclick="DisplayUserSelection('new')">New User</a></li>
        </ul>        
    </div>
</div> 
<div id="divExistingUsers" style="padding-top:25px;margin-left:10%;display:none;">
    <div style=padding-bottom:25px;">
        <span style="padding-right:3%; font-size:16px;">Please select your User Name?</span>
        <select id="ddlUsers">
        </select>
        <button type="button" class="btn" style="border:solid 1px Black;margin-left:50px;" onclick="GenerateRecommendations()">Submit</button>
    </div>
    <div style="width:50%;padding-top:10px;float:left;padding-right:10%;">
       <div style="width:80%;float:left;">
            <h3>Recommended Articles for you:</h3>
            <span style="padding-top:10px;">
                <ul class="list-group" id="lstArticles">
                </ul>
            </span>
        </div>
    </div>
    <div style="width:50%;padding-top:15px;float:left;padding-right:10%;">
       <div style="width:80%;float:left;">
            <h3>Users with similar interests as you:</h3>
            <span style="padding-top:10px;">
                <ul class="list-group" id="lstUsers">
                </ul>
            </span>
        </div>
    </div>
</div>
<div id="divNewUsers" style="padding-top:30px;display:none;">
    <div style="width:40%; float:left; border-right: solid 1px Black;margin-left:10%;" >    
        <h4>Please choose your interest level in the following:</h4>
        <table style="width:100%;" id="tblTopics">
            <tr>
                <td style="width:50%; text-align:center;">
                
                </td>
                <td style="width:30%;text-align:center;padding-left:10%;padding-right:10%;">
                    <div class="pull-right"><img src = "/images/thumbsup.png" width="20"/></div>
                    <div class="pull-left"><img src = "/images/thumbsdown.png" width="20"/></div>
                </td>
            </tr>
            <tr>
                <td style="width:50%; text-align:center;">
                    <div id="TopicCard" class="card card-default" style="background-color:#ffd6cc; height:40px;">
                        <div style="vertical-align:center;padding-top:10px;">Topic 1</div>
                    </div>
                </td>
                <td style="width:30%;text-align:center;padding-left:10%;padding-right:10%;">
                    <input type="text"  style="border:none;text-align:right;" id="txtLabel" value="0%"></input>
                    <input type="range" min="0" max="100" step="5" value="0" id="fader" onchange="UpdateSliderLabel(this)">
                </td>  
            </tr>
            <tr>
                <td style="width:50%; text-align:center;">
                    <div id="TopicCard" class="card card-default" style="background-color:#b3ffb3; height:40px;">
                        <div style="vertical-align:center;padding-top:10px;">Topic 2</div>
                    </div>
                </td>
                <td style="width:30%;text-align:center;padding-left:10%;padding-right:10%;">
                    <input type="text" class="pull-right" style="border:none;text-align:right;" id="txtLabel" value="0%"></input>
                    <input type="range" min="0" max="100" step="5" value="0" id="fader" onchange="UpdateSliderLabel(this)">
                </td>  
            </tr>
            <tr>
                <td style="width:50%; text-align:center;">
                    <div id="TopicCard" class="card card-default" style="background-color:#ffd1b3; height:40px;">
                        <div style="vertical-align:center;padding-top:10px;">Topic 3</div>
                    </div>
                </td>
                <td style="width:30%;text-align:center;padding-left:10%;padding-right:10%;">
                    <input type="text" class="pull-right" style="border:none;text-align:right;" id="txtLabel" value="0%"></input>
                    <input type="range" min="0" max="100" step="5" value="0" id="fader" onchange="UpdateSliderLabel(this)">
                </td>   
            </tr>
            <tr>
                <td style="width:50%; text-align:center;">
                    <div id="TopicCard" class="card card-default" style="background-color:#c2d6d6; height:40px;">
                        <div style="vertical-align:center;padding-top:10px;">Topic 4</div>
                    </div>
                </td>
                <td style="width:30%;text-align:center;padding-left:10%;padding-right:10%;">
                    <input type="text" class="pull-right" style="border:none;text-align:right;" id="txtLabel" value="0%"></input>
                    <input type="range" min="0" max="100" step="5" value="0" id="fader" onchange="UpdateSliderLabel(this)">
                </td>  
            </tr>
            <tr>
                <td style="width:50%; text-align:center;">
                    <div id="TopicCard" class="card card-default" style="background-color:#99b3ff; height:40px;">
                        <div style="vertical-align:center;padding-top:10px;">Topic 5</div>
                    </div>
                </td>
                <td style="width:30%;text-align:center;padding-left:10%;padding-right:10%;">
                    <input type="text" class="pull-right" style="border:none;text-align:right;" id="txtLabel" value="0%"></input>
                    <input type="range" min="0" max="100" step="5" value="0" id="fader" onchange="UpdateSliderLabel(this)">
                </td>   
            </tr>
        </table>
           
        <div style="padding-top:30px; float:center; text-align:center;">
            <button type="button" class="btn" style="background-color:#6c757d;border:solid 1px Black;color:white;" onclick="ClickSubmit()">Submit</button>
        </div>
    </div>
</div>
<div class="loader" id="divLoader" style="margin-left:45%;display:none;"></div>
<footer id="footer">
    <div style="text-align:center;">
      <div style="width:20%;float:left;font-weight:500; text-decoration:underline;text-align:center;padding-top:10px;">Angad Srivastava</div>
      <div style="width:20%;float:left;font-weight:500; text-decoration:underline;text-align:center;padding-top:10px;">Fam Guo Teng</div>
      <div style="width:20%;float:left;font-weight:500; text-decoration:underline;text-align:center;padding-top:10px;">Matilda Tan Ying Xuan</div>
      <div style="width:20%;float:left;font-weight:500; text-decoration:underline;text-align:center;padding-top:10px;">Wang Rui</div>
      <div style="width:20%;float:left;font-weight:500; text-decoration:underline;text-align:center;padding-top:10px;">Zhuang Yan</div> 
    </div>
</footer>
</body>
</html>


<script type="text/javascript">
var userList = {};
var user_user_Dict = {};
var user_item_Dict = {};
var articleDir = "https://raw.githubusercontent.com/angad-sr/ISSS609---Group-2---Text-Analytics/master/Articles/"

// Reading user recommendations for existing users
d3.tsv("https://raw.githubusercontent.com/angad-sr/Text-Analytics/master/data/User%20User%20Similarity.tsv", function(error, data) {      
    document.getElementById("divLoader").style.display = "block";
    data.forEach(function(d) {        
        reco_list = [];
        for (var i = 1; i < Object.keys(d).length; i++) {
            if (d["User"+String(i)].length > 4)
                reco_list.push(d["User"+String(i)].substring(0, d["User"+String(i)].length - 4));            
        }
        user_user_Dict[d.Primary_User.substring(0, d.Primary_User.length - 4)] = reco_list;
    });
    document.getElementById("divLoader").style.display = "none";
});

// Reading article recommendations for existing users
d3.tsv("https://raw.githubusercontent.com/angad-sr/Text-Analytics/master/data/User%20Article%20Similarity.tsv", function(error, data) {      
    document.getElementById("divLoader").style.display = "block";
    data.forEach(function(d) {        
        reco_list = [];
        for (var i = 1; i < Object.keys(d).length; i++) {
            if (d["Article"+String(i)].length > 4)
                reco_list.push(d["Article"+String(i)].substring(0, d["Article"+String(i)].length - 4));            
        }
        user_item_Dict[d.Primary_User.substring(0, d.Primary_User.length - 4)] = reco_list;
    });
    document.getElementById("divLoader").style.display = "none";
});

// Reading existing user master list
d3.csv("https://raw.githubusercontent.com/angad-sr/ISSS609---Group-2---Text-Analytics/master/data/Users%20Lookup.csv", function(error, data) {
    document.getElementById("divLoader").style.display = "block";
    data.forEach(function(d) {        
        userList[d.UserId] = d.UserName;
        var sel = document.getElementById('ddlUsers');
        var opt = document.createElement('option');
        opt.innerHTML = d.UserName;
        opt.value = d.UserId;
        sel.appendChild(opt);                
    });
    document.getElementById("divLoader").style.display = "none";
});

// Conditional display of page sections
function DisplayUserSelection(value) {
    if(value == "new")
    {
        document.getElementById("divExistingUsers").style.display = "none";
        document.getElementById("divNewUsers").style.display = "block";
    }
    if(value == "existing")
    {
        document.getElementById("divExistingUsers").style.display = "block";
        document.getElementById("divNewUsers").style.display = "none";
    }    
}

// Update Slider for Topic selection
function UpdateSliderLabel(element) {
    element.previousElementSibling.value=element.value+"%"; 
}

// Store Input Vector and compute for similar users
function ClickSubmit()
{
    inputVector = [];
    var num_of_topics = 5
    var score = 0;
    var topicTable = document.getElementById("tblTopics");
    for (var i = 0, row; row = topicTable.rows[i]; i++) {
       score = 0;
       for (var j = 1, col; col = row.cells[j]; j++) {
            score = col.getElementsByTagName("input")[0].value;
            score = parseFloat(score.substring(0, score.length - 1))/100
       }
        inputVector.push(score);           
    }
    alert(VectorNormalization(Math.min(...inputVector), Math.max(...inputVector), inputVector));
}

// Normalizing Input Vector
function VectorNormalization(min, max, vector)
{
    for (var i = 0; i < vector.length; i++)
    {
        vector[i] = (vector[i] - min)/(max - min);
    }
    return vector;
}

// Generate User and Article recommendations for existing users
function GenerateRecommendations() {
    userID = document.getElementById("ddlUsers").value;
    selectedUserUsers = user_user_Dict["User_"+String(userID)];
    selectedUserArticles = user_item_Dict["User_"+String(userID)];
    
    document.getElementById("lstUsers").innerHTML = "";
    document.getElementById("lstArticles").innerHTML = "";

    for (var i = 0; i < selectedUserUsers.length; i++) {
        document.getElementById("lstUsers").innerHTML += "<li class='list-group-item' style='width:50%;text-align:center;'>"+ userList[selectedUserUsers[i].substring(5)] +"</li>";
    }    

    for (var i = 0; i < selectedUserArticles.length; i++) {
        document.getElementById("lstArticles").innerHTML += "<li class='list-group-item' style='width:50%;text-align:center;'><a href='"+ String(articleDir+selectedUserArticles[i]) +".txt' target='_blank'>"+ selectedUserArticles[i] +"</a></li>";
    }
}

</script>